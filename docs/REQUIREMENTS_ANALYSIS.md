# サーバーバックアップ自動化ツール - 要件定義分析書（CAIP法準拠）

## エグゼクティブサマリー

### プロジェクト概要
- **プロジェクト名**: サーバーバックアップ自動化ツール
- **開始日**: 2026-01-08
- **目標納期**: 2週間以内（2026-01-22）
- **開発方針**: MVP（Minimum Viable Product）アプローチ
- **成果目標**: サーバー内の任意フォルダを3クリック以内で完全バックアップ可能なデスクトップツール

### 技術スタック決定事項
- **フロントエンド**: React 18 + TypeScript 5 + Tailwind CSS
- **バックエンド**: Rust + Tauri 2.x
- **データストレージ**: ローカルファイル（TOML形式）+ OS標準キーチェーン
- **配布方法**: GitHub Releases（無料）

---

## 1. 機能要件の整理

### 1.1 必須実装機能（MVP範囲）

#### P-001: メインページ（バックアップ実行）
| 機能ID | 機能名 | 詳細 | 優先度 |
|--------|--------|------|--------|
| F-001-1 | サーバー接続状態表示 | SSH接続の成功/失敗をリアルタイム表示 | 必須 |
| F-001-2 | フォルダ選択 | サーバー側フォルダをドロップダウンまたは入力で選択 | 必須 |
| F-001-3 | バックアップ実行 | ワンクリックでバックアップ開始 | 必須 |
| F-001-4 | 進捗表示 | ファイル数、転送速度、残り時間をリアルタイム表示 | 必須 |
| F-001-5 | 結果通知 | 成功/失敗の明確な表示と保存先フォルダへのリンク | 必須 |

#### P-002: 設定ページ
| 機能ID | 機能名 | 詳細 | 優先度 |
|--------|--------|------|--------|
| F-002-1 | SSH接続設定 | ホスト名、ポート、ユーザー名、秘密鍵の設定 | 必須 |
| F-002-2 | 保存先設定 | ローカル保存先フォルダの選択・設定 | 必須 |
| F-002-3 | 接続テスト | 設定したSSH情報での接続確認 | 必須 |
| F-002-4 | 設定保存 | OS標準キーチェーンへの暗号化保存 | 必須 |
| F-002-5 | 設定読込 | 保存済み設定の自動読み込み | 必須 |

### 1.2 実装禁止機能（Phase 11まで延期）

| 機能名 | 延期理由 | 想定Phase |
|--------|----------|-----------|
| 自動スケジューラー | MVP完成後の機能拡張 | Phase 11 |
| バックアップ履歴表示 | コア機能の完成を優先 | Phase 11 |
| 複数プロファイル管理 | 単一プロファイルで十分 | Phase 11 |
| 差分バックアップ（rsync） | 完全バックアップで開始 | Phase 11 |
| 圧縮オプション | 転送効率より実装速度優先 | Phase 11 |

---

## 2. 非機能要件

### 2.1 パフォーマンス要件

| 項目 | 要件 | 測定基準 |
|------|------|----------|
| 起動時間 | 0.4秒以内 | アプリケーションアイコンクリックから画面表示まで |
| メモリ使用量 | 40MB以下 | 起動時のメモリ消費量 |
| バイナリサイズ | 5MB以下 | 配布ファイルのサイズ |
| 転送速度 | ネットワーク帯域の80%以上活用 | 実効転送速度/理論最大速度 |
| 接続タイムアウト | 30秒 | SSH接続試行の最大待機時間 |
| リトライ回数 | 最大3回 | 接続失敗時の自動再試行 |

### 2.2 セキュリティ要件

#### 認証・認可
| 項目 | 要件 | 実装方法 |
|------|------|----------|
| SSH認証 | 公開鍵認証のみ | パスワード認証は完全禁止 |
| 秘密鍵管理 | OS標準キーチェーン保存 | macOS: Keychain、Windows: Credential Manager |
| パーミッション | 600または400のみ許可 | 秘密鍵ファイルの権限チェック |
| ログ管理 | 機密情報の除外 | パスワード、秘密鍵内容は記録禁止 |

#### データ保護
| 項目 | 要件 | 実装方法 |
|------|------|----------|
| 設定ファイル | ローカル保存（認証情報除く） | TOML形式、認証情報はキーチェーン |
| ファイルパス検証 | ディレクトリトラバーサル対策 | 絶対パスのみ許可、相対パス禁止 |
| エラーメッセージ | 機密情報の非表示 | パス情報、認証情報を含まない |

### 2.3 UI/UX要件

#### 操作性
| 項目 | 要件 | 成功基準 |
|------|------|----------|
| 操作ステップ数 | 3クリック以内 | フォルダ指定→実行→完了 |
| 初期設定時間 | 5分以内 | 技術知識ゼロでも設定完了 |
| エラー表示 | 明確な問題説明 | 何が問題か、どう対処すべきか表示 |
| 進捗表示 | リアルタイム更新 | 1秒ごとに進捗情報更新 |

#### アクセシビリティ
| 項目 | 要件 | 実装方法 |
|------|------|----------|
| 言語対応 | 日本語優先 | UIは日本語、エラーメッセージも日本語化 |
| 画面解像度 | 1280x720以上対応 | レスポンシブデザイン採用 |
| OS対応 | Mac/Windows両対応 | macOS 10.15+、Windows 7+ |

---

## 3. 技術制約と開発制約

### 3.1 外部サービス制約

#### エックスサーバー仕様
| 項目 | 制約 | 対応方法 |
|------|------|----------|
| SSHポート | 10022固定 | ポート番号をハードコード |
| 認証方式 | 公開鍵認証のみ | パスワード入力UIを削除 |
| 秘密鍵形式 | OpenSSH形式 | 形式チェック機能実装 |
| 転送サイズ | デフォルト1GB、最大2GB | 大容量ファイル分割転送 |

### 3.2 開発環境制約

#### ポート設定
```yaml
frontend: 3347  # 他プロジェクトとの競合回避
backend: 8547   # Tauriデバッグサーバー
database: なし  # ローカルファイルのみ
```

#### 環境変数
```yaml
SSH_KEY_PATH: 開発用秘密鍵パス（.env.local）
BACKUP_TEST_HOST: テスト用サーバー（.env.local）
```

### 3.3 コーディング規約

#### 命名規則
| 対象 | 規則 | 例 |
|------|------|-----|
| コンポーネント | PascalCase.tsx | BackupProgress.tsx |
| ユーティリティ | camelCase.ts | sftpClient.ts |
| 定数ファイル | UPPER_SNAKE_CASE.ts | SSH_CONFIG.ts |
| Rustコマンド | snake_case | start_backup |
| JS呼び出し | camelCase | startBackup |

#### コード品質基準
| 項目 | 基準値 | 強制力 |
|------|--------|--------|
| TypeScript | strictモード有効 | 必須 |
| 関数行数 | 100行以下 | 必須 |
| ファイル行数 | 700行以下 | 必須 |
| 複雑度(McCabe) | 10以下 | 必須 |
| 行長 | 120文字 | 推奨 |

---

## 4. MVP制約事項の詳細

### 4.1 スコープ定義

#### 実装範囲（IN SCOPE）
1. **基本機能**
   - 単一サーバーへの接続
   - 単一フォルダの完全バックアップ
   - 手動実行のみ
   - 設定の永続化

2. **UI構成**
   - メインページ（バックアップ実行）
   - 設定ページ（接続設定）
   - 2ページのみ、追加ページ禁止

3. **エラーハンドリング**
   - 接続エラーの分類表示
   - リトライ機能（3回まで）
   - 明確なエラーメッセージ

#### 実装範囲外（OUT OF SCOPE）
1. **高度な機能**（すべてPhase 11で検討）
   - 自動スケジュール実行
   - 複数サーバー管理
   - 差分バックアップ
   - 圧縮・暗号化
   - バックアップ履歴

2. **管理機能**
   - ユーザー認証（単一ユーザー想定）
   - ログ分析ダッシュボード
   - レポート機能

### 4.2 成功指標（KPI）

| 指標 | 目標値 | 測定方法 |
|------|--------|----------|
| 開発期間 | 2週間以内 | プロジェクト開始から動作確認まで |
| 操作ステップ | 3クリック以内 | ユーザビリティテスト |
| 設定時間 | 5分以内 | 初回セットアップの計測 |
| バイナリサイズ | 5MB以下 | 配布ファイルの実測 |
| メモリ使用量 | 40MB以下 | タスクマネージャーで確認 |

---

## 5. Phase定義と優先順位

### 5.1 開発フェーズ

| Phase | 名称 | 期間 | 状態 | 成果物 |
|-------|------|------|------|--------|
| Phase 1 | 要件定義 | 1日 | ✅完了 | requirements.md |
| Phase 2 | Git/GitHub管理 | 0.5日 | ✅完了 | リポジトリ初期化 |
| Phase 3 | フロントエンド基盤 | 2日 | 未着手 | React+TypeScript環境 |
| Phase 4 | ページ実装 | 3日 | 未着手 | 2ページのUI完成 |
| Phase 5 | バックエンド実装 | 4日 | 未着手 | Rust/Tauri統合 |
| Phase 6 | テスト・品質保証 | 1日 | 未着手 | 動作確認完了 |
| Phase 7 | 配布・デプロイ | 1日 | 未着手 | GitHub Releases設定 |
| Phase 8 | ドキュメント作成 | 0.5日 | 未着手 | README、使用説明書 |
| Phase 9 | 本番環境設定 | 0.5日 | 未着手 | 署名、公証設定 |
| Phase 10 | リリース準備 | 0.5日 | 未着手 | v1.0.0リリース |
| Phase 11 | 機能拡張 | 未定 | 保留 | 追加機能実装 |

### 5.2 優先順位マトリクス

#### 必須機能（P0: MVP必須）
1. SSH接続・認証
2. フォルダ選択・バックアップ実行
3. 進捗表示
4. 設定保存・読込
5. エラーハンドリング

#### 重要機能（P1: MVP完成後すぐ）
1. 接続テスト機能の改善
2. より詳細な進捗表示
3. バックアップ完了通知

#### 希望機能（P2: Phase 11で検討）
1. スケジュール実行
2. 複数プロファイル
3. 差分バックアップ
4. 圧縮オプション
5. 履歴表示

---

## 6. リスク分析と対策

### 6.1 技術リスク

| リスク | 発生確率 | 影響度 | 対策 |
|--------|----------|--------|------|
| Tauri 2.x破壊的変更 | 低 | 高 | 公式ドキュメント確認、Web検索で解決済み |
| SSH接続の不安定性 | 中 | 高 | リトライ機能、タイムアウト設定 |
| 大容量ファイル転送失敗 | 中 | 中 | チャンク分割、レジューム機能（将来） |
| OS間の互換性問題 | 低 | 高 | 早期の両OS テスト |

### 6.2 プロジェクトリスク

| リスク | 発生確率 | 影響度 | 対策 |
|--------|----------|--------|------|
| スコープクリープ | 高 | 高 | MVP制約の厳守、機能追加の完全禁止 |
| 2週間納期の遅延 | 中 | 中 | 日次進捗確認、問題の早期エスカレーション |
| テスト不足 | 低 | 高 | 最低限の動作確認に集中 |

---

## 7. 次のアクション

### 即時実行タスク（Phase 3開始）
1. [ ] Tauri開発環境のセットアップ
   - Rustインストール
   - Tauri CLIインストール
   - プロジェクト初期化

2. [ ] フロントエンド基盤構築
   - React + TypeScript設定
   - Tailwind CSS導入
   - ルーティング設定

3. [ ] 基本UIコンポーネント作成
   - レイアウトコンポーネント
   - ボタン、フォーム部品
   - 進捗表示コンポーネント

### 週次マイルストーン
- **Week 1（〜1/15）**: フロントエンド完成、バックエンド着手
- **Week 2（〜1/22）**: 統合テスト、配布準備、リリース

---

## 8. 承認事項

### 確定事項（変更不可）
- ✅ 2ページ構成（メイン、設定）
- ✅ Tauri 2.x採用
- ✅ MVP範囲の厳守
- ✅ 2週間納期

### 保留事項（Phase 11で再検討）
- ⏸ 自動化機能全般
- ⏸ 複数プロファイル
- ⏸ 高度なバックアップオプション

---

## 改訂履歴

| 日付 | バージョン | 変更内容 | 作成者 |
|------|-----------|----------|--------|
| 2026-01-10 | 1.0.0 | 初版作成（CAIP法準拠） | 要件定義エージェント |

---

## 付録: CAIP法適用の根拠

### Context（背景）
- エックスサーバーユーザーの手動バックアップ負荷軽減
- 技術知識不要な自動化ツールのニーズ
- クロスプラットフォーム対応の必要性

### Analysis（分析）
- 既存ツールの問題点: 複雑、高価、プラットフォーム限定
- 技術選定: Tauri採用で軽量・高速・セキュア実現
- MVP アプローチで最速リリース

### Implementation（実装）
- 2週間スプリントでのアジャイル開発
- 必須機能のみに集中
- 段階的な機能追加計画

### Progress（進捗）
- 日次での進捗確認
- Phase単位での成果物管理
- KPIに基づく品質管理